<!doctype html>
<html lang="tr">
<head>
  <link rel="stylesheet" href="style.css">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HocAlm — Profilim</title>
  <meta name="description" content="Öğrenme stilin, skorların ve sana özel tüyolar.">
  <style>
    :root{
      --text:#0b1220; --muted:#475569; --border:#e5e7eb; --card:#ffffff;
      --pri:#0b1220; --ok:#16a34a; --bg:#fffaf0;
      --container:1140px; --pad:28px; --radius:20px;
    }
    *{box-sizing:border-box} html,body{margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:#fffdf5}
    img{max-width:100%;display:block}
    .container{max-width:var(--container);margin-inline:auto;padding-inline:var(--pad)}

    /* NAVBAR */
    .navbar{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid var(--border)}
    .nav{min-height:64px;display:flex;align-items:center;gap:16px}
    .brand{font-weight:900}
    .links{margin-left:auto;display:flex;align-items:center;gap:18px}
    .links a{color:inherit;text-decoration:none;padding:8px 10px;border-radius:10px}
    .links a:hover{background:#f1f5f9}

    /* GENEL */
    main{padding:28px 0 60px}
    h1.title{font-size:clamp(28px,3.6vw,40px);margin:10px 0 6px}
    .muted{color:var(--muted)}
    .badge{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;font-weight:700;font-size:13px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #bbf7d0;background:#f0fdf4;font-size:13px}

    /* BUTONLAR */
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid var(--pri);border-radius:12px;padding:10px 14px;font-weight:800;text-decoration:none;cursor:pointer;transition:.18s ease}
    .btn.-primaryBlue{background:#3b82f6;color:#fff;border-color:#3b82f6;box-shadow:0 6px 16px rgba(59,130,246,.22)}
    .btn.-primaryBlue:hover{background:#2563eb;transform:translateY(-1px)}
    .btn.-outline{border-color:#cbd5e1;background:#fff;color:#0b122a}
    .btn.-outline:hover{background:#f8fafc}
    .btn.-ghostDashed{border-style:dashed;border-color:#94a3b8;color:#475569;background:#fff}
    .btn.-ghostDashed:hover{border-color:#0b1220;color:#0b1220}
    /* yeni: dashboard ile aynı solid yeşil */
    .btn.-green{border-color:#16a34a;background:#16a34a;color:#fff;box-shadow:0 6px 16px rgba(22,163,74,.22)}
    .btn.-green:hover{background:#15803d}

    /* KARTLAR */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-top:8px}
    .card{background:#fff;border:1px solid var(--border);border-radius:18px;padding:22px;box-shadow:0 10px 24px rgba(0,0,0,.05)}
    .card h2{margin:0 0 12px}
    .chips{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0 12px}
    .kvs{display:grid;grid-template-columns:1fr auto;gap:10px 14px}
    .bar{height:8px;background:#f1f5f9;border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;width:0;background:var(--ok)}
    .list{margin:0;padding-left:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}

    /* Detay kartı */
    .card.detay{display:flex;flex-direction:column;min-height:380px;position:relative;overflow:hidden}
    .headRow{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:8px}
    .stats-hero{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin:8px 0 14px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;font-weight:700;font-size:13px}
    .chip.primary{border-color:#bfdbfe;background:#eff6ff}.chip.secondary{border-color:#fde68a;background:#fffbeb}
    .chip .dot{width:8px;height:8px;border-radius:50%}.chip.primary .dot{background:#3b82f6}.chip.secondary .dot{background:#f59e0b}
    .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:360px;margin:0 auto 20px}
    .stat{border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff}
    .stat .label{color:var(--muted);font-size:12px;display:block}
    .stat strong{font-size:18px}
    .kvs.center{max-width:420px;margin:8px auto 0;text-align:left}

    @media (max-width:1024px){.grid{grid-template-columns:1fr}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

  <!-- NAVBAR -->
 <header class="navbar">
  <div class="container nav">
    <div class="brand">
      <a href="index.html" style="text-decoration:none; color:inherit; font-weight:800; font-size:22px;">
        <span style="color:#0b1220;">Hoc</span><span style="color:#3b82f6; margin-left:-1px;">AIm</span>
      </a>
    </div>
    <div class="links">
      <a href="#pricing">Planını Seç</a>
      <a href="how-it-works.html">Nasıl Çalışır</a>
      <a href="login.html" class="btn btn-ghost" id="btnLogin">Giriş Yap</a>
      <a href="test.html" class="btn nav-main">Ücretsiz Başla</a>
    </div>
  </div>
</header>

  <main class="container">
    <h1 class="title">Profilim</h1>
    <p class="muted">Öğrenme stili sonuçların ve sana özel öneriler.</p>

    <div id="empty" class="card" style="display:none">
      Henüz bir profil bulunamadı. Önce kısa testi tamamla 👇
      <div class="row" style="margin-top:10px">
        <a class="btn -primaryBlue" href="test.html#level">🎯 Teste Başla</a>
        <a class="btn -ghostDashed" href="index.html">Ana Sayfaya Dön</a>
      </div>
    </div>

    <div id="content" class="grid" style="display:none">
      <!-- SOL: Özet + mini rapor -->
      <section class="card">
        <h2>Öğrenme Özeti</h2>
        <p class="muted" id="summaryLine"></p>

        <!-- Mini rapor -->
        <section class="card" id="miniReport" style="margin-top:10px">
          <h2 style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
            <span>📈 Öğrenme Özeti (Son 7 Gün)</span>
            <small id="miniReportRange" class="muted" style="font-weight:600"></small>
          </h2>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:center">
            <div><canvas id="sparkline" height="60"></canvas></div>
            <div style="display:grid;gap:6px">
              <div><span class="muted">Ortalama odak</span> • <strong id="avgFocus">0 dk/gün</strong></div>
              <div><span class="muted">En verimli gün</span> • <strong id="bestDay">-</strong></div>
              <div><span class="muted">Baskın stil</span> • <strong id="miniStyle">-</strong></div>
              <div class="row" style="margin-top:6px;gap:8px">
                <a class="btn -primaryBlue" href="progress.html">🔎 Detaylı Raporu Aç</a>
                <button class="btn -outline" id="miniAddDemo">➕ Demo veri ekle</button>
              </div>
            </div>
          </div>
        </section>

        <div class="chips" id="summaryChips"></div>

        <div style="display:grid;gap:12px;grid-template-columns:1fr 1fr">
          <div>
            <h3>Skorlar</h3>
            <div class="kvs" id="scores"></div>
            <div style="margin-top:10px">
              <div class="bar"><span id="confBar"></span></div>
              <small class="muted">Güven: <span id="confVal"></span>%</small>
              <p id="confText" style="font-weight:600;color:#15803d;margin-top:6px;font-size:14px;"></p>
            </div>
          </div>
          <div>
            <h3>Çalışma Tüyoları</h3>
            <ul class="list" id="tips"></ul>
          </div>
        </div>

        <div class="row">
          <a class="btn -primaryBlue" href="index.html#pricing">🚀 Hadi Başlayalım</a>
          <a class="btn -outline" href="test.html#start">↻ Testi Tekrar Yap</a>
          <button class="btn -ghostDashed" id="changeLevel">🎓 Seviyeyi Değiştir</button>
        </div>
      </section>

      <!-- SAĞ: Detaylar + DERSE BAŞLA -->
      <aside class="card detay">
        <div class="headRow">
          <h2>📊 Detaylar</h2>
          <!-- yeni buton -->
          <a id="startFromProfile" class="btn -green" href="#">
            🤖 Derse Başla
          </a>
        </div>

        <div class="stats-hero">
          <span class="chip" id="chipLevel">Seviye: -</span>
          <span class="chip primary"><span class="dot"></span><span id="chipPrimary">-</span></span>
          <span class="chip secondary"><span class="dot"></span><span id="chipSecondary">-</span></span>
        </div>

        <div class="stats-grid">
          <div class="stat">
            <span class="label">Toplam Soru</span>
            <strong id="statTotal">-</strong>
          </div>
          <div class="stat">
            <span class="label">Güven</span>
            <strong id="statConf">-</strong>
          </div>
        </div>

        <div class="kvs center">
          <span class="muted">Seviye</span><strong id="levelVal">-</strong>
          <span class="muted">Toplam Soru</span><strong id="totalVal">-</strong>
          <span class="muted">Baskın Stil</span><strong id="primaryVal">-</strong>
          <span class="muted">İkincil Stil</span><strong id="secondaryVal">-</strong>
          <span class="muted">Oluşturma</span><strong id="dateVal">-</strong>
        </div>

        <div style="text-align:center;margin-top:12px">
          <a href="progress.html" class="btn -primaryBlue">📊 İlerlememi Gör</a>
          <a href="index.html" class="btn -outline">⬅️ Panele Dön</a>
          <p class="muted" style="font-size:13px;margin-top:6px">Son 14 gün performansını grafiklerle incele</p>
        </div>
      </aside>
    </div>
  </main>

<script>
/* ---------- Profil verisi ---------- */
document.addEventListener('DOMContentLoaded', () => {
  let profile = null;
  try { profile = JSON.parse(localStorage.getItem('ch.profile') || 'null'); } catch(e) {}

  if (!profile) {
    profile = {
      level:'Lise',
      primary:{code:'V',name:'Görsel'},
      secondary:{code:'A',name:'İşitsel'},
      counts:{V:6,A:2,K:1,R:1,S:0},
      confidence:85,
      total:10,
      generatedAt:Date.now()
    };
    localStorage.setItem('ch.profile', JSON.stringify(profile));
  }

  // onboarding birleşimi
  let ob = null;
  try { ob = JSON.parse(localStorage.getItem('ch.onboarding') || 'null'); } catch {}
  if (ob) {
    profile.extra = { ...(profile.extra || {}), ...ob };
    localStorage.setItem('ch.profile', JSON.stringify(profile));
  }

  document.getElementById('content').style.display = 'grid';
  document.getElementById('empty').style.display   = 'none';

  const levelText = localStorage.getItem('hocamLevel') || profile.level || 'Lise';
  document.getElementById('summaryLine').textContent =
    `Seviye: ${levelText} • Baskın stil: ${profile.primary.name} • Güven: ${profile.confidence}%`;

  const chips = document.getElementById('summaryChips');
  const nameMap = {V:'Görsel',A:'İşitsel',K:'Kinestetik',R:'Okuma-Yazma',S:'İzleyerek'};
  chips.innerHTML = Object.entries(profile.counts)
    .map(([k,v])=>`<span class="badge">${nameMap[k]}: ${v}</span>`).join('');

  const scores = document.getElementById('scores');
  scores.innerHTML = '';
  ['Görsel','İşitsel','Okuma-Yazma','Kinestetik','İzleyerek'].forEach((label,i)=>{
    const key = ['V','A','R','K','S'][i];
    const rowLabel = document.createElement('span'); rowLabel.textContent = label;
    const rowValue = document.createElement('strong'); rowValue.textContent = profile.counts[key] ?? 0;
    scores.appendChild(rowLabel); scores.appendChild(rowValue);
  });

  const bar = document.getElementById('confBar');
  document.getElementById('confVal').textContent = profile.confidence ?? 0;
  bar.style.transition = 'width 1s ease-out';
  setTimeout(()=> bar.style.width = (profile.confidence || 0) + '%', 80);

  const confText = document.getElementById('confText');
  if (profile.confidence >= 80) confText.textContent = "Mükemmel! Kendine güvenin çok yüksek 💪";
  else if (profile.confidence >= 50) confText.textContent = "İyi gidiyorsun, biraz daha güven ve tekrar et 🔁";
  else confText.textContent = "Kendine güven: %" + (profile.confidence||0) + " — gelişim potansiyelin yüksek 🚀";

  const TIPS = {
    V:["Konuları görsel özetle toparla.","Önemli yerleri renk kodla."],
    A:["Konuyu yüksek sesle anlat.","Ses kaydı alıp geri dinle."],
    K:["Mini deneyler yap.","25’+5’ hareketli pomodoro."],
    R:["Kısa özet notlar çıkar.","Formül/anahtar kartları hazırla."],
    S:["1-2 dakikalık videolarla giriş yap.","Önemli anı dondurup 3 madde not al."]
  };
  const tips = TIPS[profile.primary.code] || TIPS.V;
  document.getElementById('tips').innerHTML = tips.map(t=>`<li>${t}</li>`).join('');

  // Sağ kart verileri
  document.getElementById('chipLevel').textContent = 'Seviye: ' + levelText;
  document.getElementById('chipPrimary').textContent = profile.primary?.name || '-';
  document.getElementById('chipSecondary').textContent = profile.secondary?.name || '-';
  document.getElementById('statTotal').textContent = profile.total ?? '-';
  document.getElementById('statConf').textContent  = (profile.confidence ?? 0) + '%';

  document.getElementById('levelVal').textContent     = levelText;
  document.getElementById('totalVal').textContent     = profile.total;
  document.getElementById('primaryVal').textContent   = profile.primary.name;
  document.getElementById('secondaryVal').textContent = profile.secondary.name;
  document.getElementById('dateVal').textContent      = new Date(profile.generatedAt).toLocaleString();

  // Onboarding detay ekleri
  const details = document.querySelector('aside.card.detay .kvs.center');
  if (details && profile.extra) {
    const rows = [];
    if (profile.extra.goal)        rows.push(['Hedef', profile.extra.goal]);
    if (profile.extra.consistency) rows.push(['Düzen', profile.extra.consistency]);
    if (profile.extra.dailyTime)   rows.push(['Günlük Zaman', profile.extra.dailyTime]);
    if (profile.extra.bestHours)   rows.push(['Uygun Saat', profile.extra.bestHours]);
    if (profile.extra.focusMin)    rows.push(['Dikkat Süresi', profile.extra.focusMin + ' dk']);
    rows.forEach(([k,v])=>{
      const s = document.createElement('span');   s.className='muted'; s.textContent = k;
      const strong = document.createElement('strong'); strong.textContent = v;
      details.appendChild(s); details.appendChild(strong);
    });
  }

  // Seviye değiştir
  document.getElementById('changeLevel').addEventListener('click', ()=>{
    localStorage.removeItem('hocamLevel');
    location.href = 'test.html#level';
  });

  /* ---- Derse Başla butonu: son konu varsa onu, yoksa "Limit" ---- */
  const lastTopic = localStorage.getItem('ch.lastTopic') || 'Limit';
  document.getElementById('startFromProfile').href =
    'lesson.html?topic=' + encodeURIComponent(lastTopic);
});

/* ---- Mini rapor (sparkline) ---- */
const d2 = (n)=> String(n).padStart(2,'0');
const fmtDateKey = (d)=> `${d.getFullYear()}-${d2(d.getMonth()+1)}-${d2(d.getDate())}`;
const dayNames = ['Paz','Pzt','Sal','Çar','Per','Cum','Cts'];

function getLast7DaysFocus() {
  const today = new Date();
  const items = [];
  for (let i=6; i>=0; i--) {
    const d = new Date(today); d.setDate(today.getDate()-i);
    const key = fmtDateKey(d);
    let mins = parseInt(localStorage.getItem('ch.focus:' + key) || 'NaN', 10);
    if (Number.isNaN(mins)) {
      try {
        const plan = JSON.parse(localStorage.getItem('ch.dayProgress:' + key) || 'null');
        if (plan && Array.isArray(plan.tasks)) {
          const doneCount = plan.tasks.filter(t=>t.done).length;
          mins = doneCount * 10;
        } else { mins = 0; }
      } catch(e) { mins = 0; }
    }
    items.push({ key, label: dayNames[d.getDay()], mins });
  }
  return items;
}
function calcMetrics(rows) {
  const sum = rows.reduce((a,b)=>a + b.mins, 0);
  const avg = Math.round(sum / rows.length);
  const best = rows.reduce((best, cur)=> cur.mins > best.mins ? cur : best, {mins:-1, label:'-'});
  return {avg, best};
}
function drawSparkline(rows) {
  const ctx = document.getElementById('sparkline'); if (!ctx) return;
  const data = {
    labels: rows.map(r=>r.label),
    datasets: [{ data: rows.map(r=>r.mins), fill:true, tension:.35, pointRadius:3, borderWidth:2 }]
  };
  const opt = {
    responsive:true,
    scales:{ x:{grid:{display:false}}, y:{grid:{display:false}, ticks:{display:false}, suggestedMax: Math.max(30, Math.max(...rows.map(r=>r.mins))+10) } },
    plugins:{ legend:{display:false}, tooltip:{callbacks:{label:(c)=>`${c.parsed.y} dk`}} }
  };
  new Chart(ctx, { type:'line', data, options:opt });
}
(function miniReportInit(){
  try {
    const rows = getLast7DaysFocus();
    const {avg, best} = calcMetrics(rows);
    const range = rows[0].key + ' – ' + rows[rows.length-1].key;
    document.getElementById('avgFocus').textContent = `${avg} dk/gün`;
    document.getElementById('bestDay').textContent = `${best.label} (${best.mins} dk)`;
    document.getElementById('miniReportRange').textContent = range;
    try {
      const profile = JSON.parse(localStorage.getItem('ch.profile') || 'null');
      document.getElementById('miniStyle').textContent = profile?.primary?.name || '-';
    } catch(e){}
    drawSparkline(rows);
  } catch(e) { console.warn('Mini rapor yüklenemedi:', e); }
})();
document.getElementById('miniAddDemo')?.addEventListener('click', ()=>{
  const today = new Date();
  for (let i=0; i<7; i++) {
    const d = new Date(today); d.setDate(today.getDate()-i);
    const k = 'ch.focus:' + fmtDateKey(d);
    const m = 30 + Math.floor(Math.random()*41);
    localStorage.setItem(k, String(m));
  }
  location.reload();
});
</script>
</body>
</html>
